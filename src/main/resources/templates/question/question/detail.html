<html layout:decorate="~{/common/layout/layout}">
<div layout:fragment="content" class="mx-auto max-w-3xl px-4 my-10">

    <!-- 상단 액션 -->
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
      <span class="inline-flex items-center rounded-full bg-indigo-50 text-indigo-700 text-xs font-medium px-3 py-1">
        #<span th:text="${question?.id}">0</span>
      </span>
            <h1 class="text-2xl font-semibold tracking-tight" th:text="${question?.subject}">주제</h1>
        </div>
        <div class="flex items-center gap-2">
            <!-- 수정: GET 이동 -->
            <form id="updateForm"
                  th:action="@{/questions/update/{questionId}(questionId=${question.id})}"
                  sec:authorize="isAuthenticated()"
                  th:if="${question.author != null and #authentication.name == question.author.username}"
            >
                <button
                        class="rounded-xl border px-4 py-2 text-gray-700 hover:bg-gray-50"
                        type="submit"
                >
                    질문 수정
                </button>
            </form>
            <!-- 삭제: POST + 확인 -->

            <form id="deleteQues"
                  sec:authorize="isAuthenticated()"
                  th:if="${question.author != null and #authentication.name == question.author.username}"
                  th:action="@{/questions/delete/{questionId}(questionId=${question.id})}"
                  method="post"
                  onsubmit="return confirm('정말 삭제하시겠어요?');"
            >
                <button
                        class="rounded-xl bg-red-600 px-4 py-2 text-white font-medium shadow-sm transition hover:bg-red-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500"
                        type="submit"
                >
                    질문 삭제
                </button>
            </form>
        </div>
    </div>

    <!-- 본문 카드 -->
    <div class="bg-white/80 backdrop-blur border rounded-2xl shadow-sm p-6 space-y-4">
        <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500">
      <span>
        작성자:
        <span class="font-medium text-gray-700" th:text="${question?.author?.nickname ?: '익명'}">익명</span>
      </span>
            <span class="hidden sm:inline">•</span>
            <time th:text="${#temporals.format(question?.createdDate, 'yyyy.MM.dd HH:mm:ss')}">2025.01.01 12:34:56
            </time>

            <!--            조회수-->
            <span class="hidden sm:inline">•</span>
            <span>조회수: <span th:text="${question?.viewCount}">0</span></span>

        </div>


        <div class="text-gray-800 leading-7 whitespace-pre-wrap" th:text="${question?.content}">
            내용
        </div>
    </div>

    <!-- 답변 영역 -->
    <section class="mt-8">
        <h2 class="text-lg font-semibold mb-3">답변</h2>
        <div class="rounded-2xl border bg-white/80 backdrop-blur p-4">
            <div th:replace="~{answer/answer/list :: answerList(${question})}"></div>
        </div>
    </section>

    <!-- 목록으로 -->
    <div class="mt-8">

        <a th:href="@{/questions/list}"
           class="inline-flex items-center rounded-xl border px-4 py-2 text-gray-700 hover:bg-gray-50">

            목록으로
        </a>
    </div>
</div>
</html>